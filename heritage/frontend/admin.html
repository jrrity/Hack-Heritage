<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - ARES</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <style>
        /* CSS remains the same as your provided code, with one addition */
        :root {
            --primary-color: #005B5B; --secondary-color: #FF6F61; --background-color: #F9F9F9;
            --text-color: #333333; --white-color: #FFFFFF; --font-heading: 'Poppins', sans-serif;
            --font-body: 'Nunito Sans', sans-serif;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: var(--font-body); color: var(--text-color); background-color: var(--background-color); }
        .container { max-width: 1400px; margin: 0 auto; padding: 0 20px; }
        .main-nav { background-color: var(--white-color); padding: 15px 0; position: fixed; top: 0; width: 100%; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .main-nav .container { display: flex; justify-content: space-between; align-items: center; }
        .main-nav .logo { font-family: var(--font-heading); font-size: 1.5rem; font-weight: 700; color: var(--primary-color); text-decoration: none;}
        .page-header { padding-top: 100px; padding-bottom: 30px; display:flex; justify-content: space-between; align-items: center; } /* Flex for button */
        .page-header h1 { font-size: 2.5rem; }
        .btn { display: inline-block; padding: 10px 20px; border-radius: 5px; text-decoration: none; font-weight: 700; background-color: var(--secondary-color); color: var(--white-color); transition: background-color 0.3s; }
        .btn:hover { background-color: #e65a4c; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 30px; margin-bottom: 40px; }
        .metric-card { background-color: var(--white-color); padding: 25px; border-radius: 10px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        .metric-value { font-size: 3rem; font-weight: 700; color: var(--primary-color); display: block; }
        .metric-label { font-size: 1rem; color: #555; font-weight: 700; }
        .data-section { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; align-items: flex-start; }
        .data-table-container { background-color: var(--white-color); padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        .data-table-container h3 { margin-top: 0; font-size: 1.5rem; }
        .search-input { width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 5px; font-size: 1rem; }
        .table-wrapper { max-height: 500px; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; font-size: 0.9rem; }
        th { background-color: #f7f7f7; font-weight: 700; }
        tbody tr:hover { background-color: #f1f1f1; }
        a {
            text-decoration: none;
            color: var(--text-color);
            font-weight: 700;
            transition: color 0.3s ease;
        }
        a:hover {
            color: #FF6F61;
        }
        /* Responsive styles remain the same */
    </style>
</head>
<body>
    <header class="main-nav">
        <div class="container">
            <a href="#" class="logo">ARES Admin Panel</a>
            <a href="dapp.html">Transactions</a>
        </div>
    </header>

    <main class="container">
        <section class="page-header">
            <h1>Platform Overview</h1>
            <a href="admin_verify.html" class="btn">Verify New NGOs</a>
        </section>
        
        <section class="metrics-section">
            <div class="dashboard-grid">
                <div class="metric-card"><span class="metric-value" id="totalVolunteers">0</span><p class="metric-label">Total Volunteers</p></div>
                <div class="metric-card"><span class="metric-value" id="totalNgos">0</span><p class="metric-label">Verified NGOs</p></div>
                <div class="metric-card"><span class="metric-value" id="topInterest">--</span><p class="metric-label">Top Volunteer Interest</p></div>
                <div class="metric-card"><span class="metric-value" id="topLocation">--</span><p class="metric-label">Top NGO Location</p></div>
            </div>
        </section>

        <section class="data-section">
            <div class="data-table-container">
                <h3>Registered Volunteers</h3>
                <input type="text" id="volunteerSearch" class="search-input" placeholder="Search volunteers by name, location...">
                <div class="table-wrapper">
                    <table>
                        <thead><tr><th>Name</th><th>Location</th><th>Interests</th><th>Availability</th></tr></thead>
                        <tbody id="volunteerTableBody"></tbody>
                    </table>
                </div>
            </div>
            <div class="data-table-container">
                <h3>Verified NGOs</h3>
                <input type="text" id="ngoSearch" class="search-input" placeholder="Search NGOs by name, location...">
                <div class="table-wrapper">
                    <table>
                        <thead><tr><th>NGO Name</th><th>Contact</th><th>Location</th><th>Focus Areas</th></tr></thead>
                        <tbody id="ngoTableBody"></tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const API_URL = 'http://127.0.0.1:5000';

        // Fetch all data on page load
        const fetchAdminData = async () => {
            try {
                // Fetch all endpoints concurrently
                const [statsRes, volunteersRes, ngosRes] = await Promise.all([
                    fetch(`${API_URL}/admin/stats`),
                    fetch(`${API_URL}/volunteers`),
                    fetch(`${API_URL}/ngos`) // This gets VERIFIED NGOs
                ]);

                const stats = await statsRes.json();
                const volunteers = await volunteersRes.json();
                const ngos = await ngosRes.json();

                // Populate metric cards
                document.getElementById('totalVolunteers').textContent = stats.totalVolunteers || 0;
                document.getElementById('totalNgos').textContent = stats.totalNgos || 0;
                document.getElementById('topInterest').textContent = stats.topInterest || '--';
                document.getElementById('topLocation').textContent = stats.topLocation || '--';

                // Populate tables
                renderTable('volunteerTableBody', volunteers, createVolunteerRow);
                renderTable('ngoTableBody', ngos, createNgoRow);

            } catch (error) {
                console.error("Failed to load admin data:", error);
            }
        };

        function renderTable(tableBodyId, data, createRowFunc) {
            const tableBody = document.getElementById(tableBodyId);
            tableBody.innerHTML = ''; // Clear existing data
            if (!data || data.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="4" style="text-align:center;">No data available.</td></tr>`;
                return;
            }
            data.forEach(item => tableBody.appendChild(createRowFunc(item)));
        }

        function createVolunteerRow(v) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${v.fullName || 'N/A'}</td>
                <td>${v.city || 'N/A'}</td>
                <td>${Array.isArray(v.interests) ? v.interests.join(', ') : 'N/A'}</td>
                <td>${v.availability || 'N/A'}</td>`;
            return row;
        }

        function createNgoRow(n) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${n.name || 'N/A'}</td>
                <td>${n.contact_person || 'N/A'}</td>
                <td>${n.operation_area || 'N/A'}</td>
                <td>${Array.isArray(n.focus_areas) ? n.focus_areas.join(', ') : 'N/A'}</td>`;
            return row;
        }
        
        // Setup search functionality for tables
        function setupSearch(inputId, tableBodyId) {
            document.getElementById(inputId).addEventListener('keyup', (e) => {
                const term = e.target.value.toLowerCase();
                const rows = document.getElementById(tableBodyId).getElementsByTagName('tr');
                Array.from(rows).forEach(row => {
                    row.style.display = row.textContent.toLowerCase().includes(term) ? '' : 'none';
                });
            });
        }
        
        fetchAdminData();
        setupSearch('volunteerSearch', 'volunteerTableBody');
        setupSearch('ngoSearch', 'ngoTableBody');
    });
    </script>
</body>
</html>